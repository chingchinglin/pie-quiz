<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>英文學習，你是哪一 PIE？</title>
  <style>
    /* Base styles */
    body {
      font-family: "Noto Sans TC", sans-serif;
      background: #fff8f0;
      margin: 0;
      padding: 0;
    }
    header, main, footer {
      padding: 1rem;
      text-align: center;
    }
    header img {
      width: 100%;
      max-width: 320px;
      height: auto;
      display: block;
      margin: 0 auto;
    }
    .question, .result {
      display: none;
      margin-top: 2rem;
    }
    button {
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s ease;
      -webkit-tap-highlight-color: transparent; /* 移除手機點擊殘影 */
    }
    .choices {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
      padding-top: 1rem;
    }
    .choice-btn {
      width: 90%;
      max-width: 500px;
      padding: 0.75rem;
      border-radius: 12px;
      background: #ffe5ec;
      font-size: 1.05rem;
      border: 1px solid #e4b1ab;
      cursor: pointer;
    }
    .choice-btn:hover {
      background: #ffcad4;
    }
    /* 清除點選殘留背景 */
    .choice-btn:focus,
    .choice-btn:active,
    .choice-btn:focus-visible {
      outline: none !important;
      box-shadow: none !important;
      background-color: #ffe5ec !important;
    }
    .choice-btn {
  /* 已有的規則，保留前面設定 */
  -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊時的高亮（灰色暈染） */
  touch-action: manipulation;               /* 移除 300ms 延遲並防止某些手勢影響 */
  -webkit-touch-callout: none;              /* iOS 長按不出現放大／選單提示 */
  -webkit-user-select: none;                /* 禁止選字，避免粗選時殘留 */
}

/* 確保 :active 時也不套用任何灰色遮罩 */
.choice-btn:active {
  background-color: #ffe5ec !important;     /* 強制還原背景顏色 */
  box-shadow: none !important;
}

/* 如果想更保險地覆蓋掉 Android 與 iOS 的種種殘影，也可以這樣做： */
button, .choice-btn {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}
    img.result-img {
      width: 100%;
      max-width: 420px;
      margin-top: 1.2rem;
      border-radius: 12px;
    }
    .result-actions {
      margin-top: 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    @media screen and (min-width: 768px) {
      body {
        font-size: 18px;
      }
      header img {
        max-width: 504px;
      }
      .question {
        max-width: 720px;
        margin: 2rem auto;
      }
      .result {
        max-width: 640px;
        margin: 2rem auto;
        font-size: 1.2rem;
      }
      .choice-btn {
        font-size: 1.15rem;
      }
      .result-actions button {
        font-size: 1.1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="1.png" alt="PIE封面圖" style="max-width: 504px; height: auto; margin: 0 auto; display: block;"/>
    <button onclick="startQuiz()" style="padding: 0.7rem 1.2rem; font-size: 1.1rem; background: #fcd5ce;">
      開始測驗
    </button>
  </header>

  <main id="quiz">
    <div class="question" id="questionBox">
      <h2 id="questionText"></h2>
      <div class="choices" id="choiceBox"></div>
    </div>

    <div class="result" id="resultBox">
      <img id="resultImg" class="result-img" src="" alt="result image"/>
      <div class="result-actions">
        <button onclick="window.open('https://www.junyiacademy.org/event/act-eng-prep-summer-25/', '_blank')" style="background-color: #d0ebff; color: #003366; padding: 0.7rem 1rem; font-size: 1.05rem;">
          🎯 加入「英文學測選手村」，找出你的學習派」
        </button>
        <div style="display: flex; gap: 0.5rem; justify-content: center; flex-wrap: wrap;">
          <button onclick="copyImage()" style="background-color: #fcd5ce; color: #000; padding: 0.7rem 1rem;">
            📋 複製圖片
          </button>
          <button onclick="location.reload()" style="background-color: #dee2e6; color: #000; padding: 0.7rem 1rem;">
            🔄 再玩一次
          </button>
          <button onclick="copyLink()" style="background-color: #caffbf; color: #000; padding: 0.7rem 1rem;">
            🔗 分享測驗
          </button>
        </div>
        <p id="copyMsg" style="display:none; color: green; font-size: 0.9rem;">✅ 已複製連結！</p>
      </div>
    </div>
  </main>

  <script>
    const questions = [
      {
        text: "和同學踏入平常常去的早餐店，突然發現菜單改成英文了!這時你會怎麼點餐呢？",
        choices: [
          ['💬', '看照片或是跟著朋友點'],
          ['⚔️', '認真研究每道菜色'],
          ['🧠', '靠印象猜菜單意思'],
          ['📘', '慢慢看完再決定'],
          ['✍️', '試著寫下一份自己特製的餐點']
        ]
      },
      {
        text: "突然收到朋友用英文發來的訊息，你的回應是？",
        choices: [
          ['💬', '直接模仿對方語氣回覆'],
          ['⚔️', '用翻譯工具確認句構正確'],
          ['🧠', '快速抓幾個單字猜重點'],
          ['📘', '一字一句讀出上下文關係'],
          ['✍️', '嘗試用自己的句型回信、編寫清楚內容']
        ]
      },
      {
        text: "下課前，老師出了一份英文作文，很少寫英文作文的你，會怎麼辦？",
        choices: [
          ['💬', '想像口說內容直接寫'],
          ['⚔️', '先列主詞＋動詞＋受詞結構'],
          ['🧠', '先挑單字列出再想句子'],
          ['📘', '找文章範例模仿語氣'],
          ['✍️', '自己架構文章邏輯，選擇句型與段落配置']
        ]
      },
      {
        text: "睡覺前看看Youtube 學英文吧！啊～～有一段看不懂英文句子看不懂，你怎麼做？",
        choices: [
          ['💬', '反覆聽幾遍模仿說出來'],
          ['⚔️', '逐句抄下來解析文法'],
          ['🧠', '回聽關鍵單字猜意思'],
          ['📘', '開字幕比對上下文'],
          ['✍️', '試著把聽到的內容自己用文字寫下來整理']
        ]
      },
      {
        text: "學期末有一場英文小組報告，你負責的部分是？",
        choices: [
          ['💬', '等同學報告來，我負責報告'],
          ['⚔️', '研究怎麼讓報告拿高分的技巧'],
          ['🧠', '找老師曾經補充過的資料'],
          ['📘', '把大家資料彙整起來'],
          ['✍️', '統整大家的資料與校對內容']
        ]
      },
      {
        text: "期待已久的暑假終於來了！跟同學出去玩，迎面而來的外國人對你開口打招呼，這時你會？",
        choices: [
          ['💬', '先講再說，能溝通就好'],
          ['⚔️', '想句型想太久講不出口'],
          ['🧠', '先把會的單字塞進去'],
          ['📘', '讓我回想一下之前看過的對話範例'],
          ['✍️', '默默在心裡重組句子，想著怎麼用文字來表達會更順']
        ]
      }
    ];

    const results = {
      '💬': '2.png',
      '⚔️': '3.png',
      '🧠': '4.png',
      '📘': '5.png',
      '✍️': '6.png'
    };

    let current = 0;
    let counts = { '💬': 0, '⚔️': 0, '🧠': 0, '📘': 0, '✍️': 0 };

    function startQuiz() {
      document.querySelector('header').style.display = 'none';
      document.getElementById('quiz').style.display = 'block';
      showQuestion();
    }

    function showQuestion() {
      const qBox = document.getElementById('questionBox');
      const qText = document.getElementById('questionText');
      const cBox = document.getElementById('choiceBox');
      const q = questions[current];

      qBox.style.display = 'block';
      document.getElementById('resultBox').style.display = 'none';

      cBox.innerHTML = '';
      document.activeElement?.blur(); // 清除先前按鈕焦點

      qText.textContent = q.text;
      q.choices.forEach(([emoji, desc]) => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerHTML = `<span style="font-size: 1.3rem;">${emoji}</span> ${desc}`;
        btn.onclick = () => {
          choose(emoji);
          btn.blur(); // 按下後立即清除焦點
        };
        cBox.appendChild(btn);
      });
    }

    function choose(choice) {
      counts[choice]++;
      current++;

      setTimeout(() => {
        document.activeElement?.blur(); // 延遲再清除一次焦點
      }, 10);

      if (current >= questions.length) {
        showResult();
      } else {
        showQuestion();
      }
    }

    function showResult() {
      document.getElementById('questionBox').style.display = 'none';
      const top = Object.entries(counts).sort((a, b) => b[1] - a[1])[0][0];
      const resultImg = results[top];
      document.getElementById('resultImg').src = resultImg;
      document.getElementById('resultBox').style.display = 'block';
    }

    function downloadResult() {
      const img = document.getElementById('resultImg');
      const link = document.createElement('a');
      link.href = img.src;
      link.download = '我的PIE結果.png';
      link.click();
    }

    function copyLink() {
      const link = window.location.href;
      navigator.clipboard.writeText(link).then(() => {
        const msg = document.getElementById('copyMsg');
        msg.style.display = 'block';
        setTimeout(() => { msg.style.display = 'none'; }, 2000);
      });
    }

    // 新增：複製結果圖片到剪貼簿
    async function copyImage() {
      try {
        const img = document.getElementById('resultImg');
        const response = await fetch(img.src);
        const blob = await response.blob();
        const item = new ClipboardItem({ [blob.type]: blob });
        await navigator.clipboard.write([item]);
        alert('圖片已複製到剪貼簿！可在社群或相簿中貼上。');
      } catch (err) {
        console.error('複製失敗：', err);
        downloadResult(); // 複製失敗時降回下載
      }
    }
  </script>
</body>
</html>
